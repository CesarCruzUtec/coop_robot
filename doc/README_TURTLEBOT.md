# Turtlebot3 (Waffle Pi)

## Installation

Install dependent ROS packages:

```bash
sudo apt-get install ros-noetic-joy ros-noetic-teleop-twist-joy \
  ros-noetic-teleop-twist-keyboard ros-noetic-laser-proc \
  ros-noetic-rgbd-launch ros-noetic-rosserial-arduino \
  ros-noetic-rosserial-python ros-noetic-rosserial-client \
  ros-noetic-rosserial-msgs ros-noetic-amcl ros-noetic-map-server \
  ros-noetic-move-base ros-noetic-urdf ros-noetic-xacro \
  ros-noetic-compressed-image-transport ros-noetic-rqt* ros-noetic-rviz \
  ros-noetic-gmapping ros-noetic-navigation ros-noetic-interactive-markers
```
Install Turtlebot3 packages:

```bash
sudo apt install ros-noetic-dynamixel-sdk
sudo apt install ros-noetic-turtlebot3-msgs
sudo apt install ros-noetic-turtlebot3
```

## Configuration

### PC Setup

Connect the PC to a Wi-Fi network and find the IP address with `ifconfig`

> The IP address is usually in the form of **192.168.X.XXX**.

Update the bashrc file with the IP address, (remember to not use whitespace between the variable and the value):

```bash
export ROS_MASTER_URI=http://192.168.X.XXX:11311
export ROS_HOSTNAME=192.168.X.XXX
```

Source the bashrc file:

```bash
source ~/.bashrc
```

### Raspberry Pi Setup

Connect the Raspberry Pi to the same Wi-Fi network as the PC, and confirm the IP address with `ifconfig`.

> The IP address is usually in the form of **192.168.X.XXX** and its different from the PC's IP address, DO NOT use the same IP address.

Update the bashrc file with the IP address:

```bash
export ROS_MASTER_URI=http://192.168.X.XXX:11311 # The PC IP address
export ROS_HOSTNAME=192.168.X.XXX # The Raspberry Pi IP address
```

## Bringup

Run roscore on the PC

```bash
roscore
```

Connect the Raspberry Pi to the PC via SSH and run the following command, if password is asked, use the default password `turtlebot`:

```bash
ssh ubuntu@{IP_ADDRESS_OF_THE_RASPBERRY_PI}
```
Bring up the Turtlebot3 robot:

```bash
export TURTLEBOT3_MODEL=waflle_pi # This should be added to the .bashrc file
roslaunch turtlebot3_bringup turtlebot3_robot.launch
```

### Visualization in Rviz (Optional)

Launch the robot state publisher, and then run the Rviz node:

```bash
roslaunch turtlebot3_bringup turtlebot3_robot.launch
rosrun rviz rviz -d `rospack find turtlebot3_description`/rviz/waffle_pi.rviz
```

### Teleoperation

To operate the Turtlebot3 robot, use the following command:

```bash
export TURTLEBOT3_MODEL=waflle_pi
roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch
```

## Simulation

Export the Turtlebot3 model to the Gazebo environment:

```bash
export TURTLEBOT3_MODEL=waflle_pi
```
Use a launch file to start the Gazebo simulation:

```bash
roslaunch turtlebot3_gazebo turtlebot3_empty_world.launch
roslaunch turtlebot3_gazebo turtlebot3_world.launch
roslaunch turtlebot3_gazebo turtlebot3_house.launch
```

To operate the Turtlebot3 robot in the Gazebo environment, use the following command:

```bash
roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch
```

To visualize the Turtlebot3 robot in the Rviz environment, use the following command:

```bash
roslaunch turtlebot3_gazebo turtlebot3_gazebo_rviz.launch
```

## SLAM

Export the Turtlebot3 model and launch the Gazebo simulation:
  
```bash
export TURTLEBOT3_MODEL=waflle_pi
roslaunch turtlebot3_gazebo turtlebot3_world.launch
```

Launch the SLAM node:

```bash
roslauch turtlebot3_slam turtlebot3_slam.launch slam_methods:=gmapping
```

To operate the Turtlebot3 robot in the Gazebo environment, use the following command:

```bash
roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch
```

To save the map generated by the SLAM node, use the following command:

```bash
rosrun map_server map_saver -f ~/map
```

## Navigation

Export the Turtlebot3 model and launch the Gazebo simulation:

```bash
export TURTLEBOT3_MODEL=waflle_pi
roslaunch turtlebot3_gazebo turtlebot3_world.launch
```

Launch the Navigation node:

```bash
roslaunch turtlebot3_navigation turtlebot3_navigation.launch map_file:=$HOME/map.yaml
```

On the Rviz environment, set the 2D Pose Estimate before setting the 2D Nav Goal.
1. Click the 2D Pose Estimate button.
2. Click on the map where the Turtlebot3 robot is located and drag the green arrow to the direction where the Turtlebot3 robot is facing.
3. Repeat the same steps until the estimated pose is close to the actual pose.
4. Launch keyboard teleoperation node to move the Turtlebot3 robot to the desired location.

```bash
roslaunch turtlebot3_teleop turtlebot3_teleop_key.launch
```
5. Move the robot back and forth to improve the accuracy of the estimated pose.
6. Terminate the keyboard teleoperation node by pressing Ctrl + C.
7. Click the 2D Nav Goal button.
8. Click on the map to set the destination of the Turtlebot3 robot and drag the green arrow to the direction where the Turtlebot3 robot will be facing.
